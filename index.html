<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>線上試衣間</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Huninn&family=Zen+Antique&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="subject.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="manifest.json" />
  </head>
  <body>
    <header><h1>線上試衣間</h1></header>
    <div class="main-content">
      <section id="flctn">
        <div class="model-container">
          <img
            id="base-model"
            src="clothes/model.png"
            alt="模特兒模型"
            class="layer-img"
            style="z-index: 0"
          />
          <img
            id="top-layer"
            src=""
            alt="上衣"
            class="layer-img"
            style="z-index: 1; display: none"
          />
          <img
            id="bottom-layer"
            src=""
            alt="下身"
            class="layer-img"
            style="z-index: 1; display: none"
          />
        </div>
      </section>
      <aside>
        <h3>衣服類型</h3>
        <ul>
          <li class="has-submenu">
            上身
            <ul class="submenu">
              <li>
                <!-- 將所有 data-* 屬性移到 img 上 -->
                <img
                  src="clothes/tshirt_thumb.png"
                  alt="短袖 T-Shirt"
                  class="item-img"
                  data-type="top"
                  data-img="clothes/tshirt.png"
                />
                <!-- 您也可以在圖片下方增加文字說明 -->
                <span>短袖 T-Shirt</span>
              </li>
            </ul>
          </li>

          <li class="has-submenu">
            下身
            <ul class="submenu">
              <li>
                <!-- 將所有 data-* 屬性移到 img 上 -->
                <img
                  src="clothes/skirt_thumb.png"
                  alt="短裙 Skirt"
                  class="item-img"
                  data-type="bottom"
                  data-img="clothes/skirt.png"
                />
                <span>短裙 Skirt</span>
              </li>
            </ul>
          </li>
          <li class="has-submenu">
            外套
            <ul class="submenu">
              <li>休閒外套</li>
              <li>針織外套</li>
              <li>罩衫</li>
              <li>背心</li>
            </ul>
          </li>
          <li class="has-submenu">
            鞋子
            <ul class="submenu">
              <li>休閒鞋</li>
              <li>跟鞋</li>
              <li>涼鞋</li>
              <li>靴子</li>
            </ul>
          </li>
          <li class="has-submenu">
            配件
            <ul class="submenu">
              <li>帽子</li>
              <li>項鍊</li>
              <li>包包</li>
            </ul>
          </li>
        </ul>
      </aside>
    </div>
    <script>
     // --- PWA Service Worker 註冊碼 (保留) ---
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function () {
    navigator.serviceWorker.register("/sw.js").then(
      function (registration) {
        console.log(
          "ServiceWorker registration successful: ",
          registration.scope
        );
      },
      function (err) {
        console.log("ServiceWorker registration failed: ", err);
      }
    );
  });
}

// --- 選單展開/收合功能 (手風琴效果) ---
const menuItems = document.querySelectorAll(".has-submenu");
menuItems.forEach((item) => {
  item.addEventListener("click", function (event) {
    event.stopPropagation();
    menuItems.forEach((otherItem) => {
      if (otherItem !== this) {
        otherItem.classList.remove("active");
      }
    });
    this.classList.toggle("active");
  });
});

// --- 圖片疊加/移除功能 (依點擊順序決定 z-index，再次點擊取消) ---

const modelContainer = document.querySelector(".model-container");

// 使用 WeakMap 來追蹤哪個縮圖對應哪個預覽圖元素
const itemToImageMap = new WeakMap();

// 用於確保圖層順序正確
let zIndexCounter = 1;

// 獲取所有可點擊的衣物縮圖圖片 (使用 .item-img class)
const itemImages = document.querySelectorAll(".item-img");

itemImages.forEach((imgElement) => {
  imgElement.addEventListener("click", function (event) {
    event.stopPropagation();

    const imgUrl = this.getAttribute("data-img");

    if (!imgUrl) return;

    // 檢查這張縮圖是否已經在預覽區顯示了對應的圖片
    if (itemToImageMap.has(this)) {
      // 情況 A: 已經存在，執行取消/移除操作

      const existingImg = itemToImageMap.get(this);
      // 從 DOM 中移除圖片元素
      modelContainer.removeChild(existingImg);
      // 從 Map 中移除綁定記錄
      itemToImageMap.delete(this); 
      // 移除視覺反饋 class (如果有的話)
      this.classList.remove("selected-item"); 

    } else {
      // 情況 B: 尚未存在，執行新增/疊加操作

      // 創建一個新的圖片元素
      const newImg = document.createElement("img");
      newImg.src = imgUrl;
      newImg.classList.add("layer-img"); // 沿用 CSS 樣式
      
      // 設置 z-index，確保後點擊的疊在上面
      newImg.style.zIndex = zIndexCounter++;

      // 將新圖片加入到 model-container 裡面
      modelContainer.appendChild(newImg);
      // 將縮圖元素 (this) 與新圖片元素綁定起來
      itemToImageMap.set(this, newImg);
      // 添加視覺反饋 class (例如加個邊框表示已選中)
      this.classList.add("selected-item");
    }
  });
});
    </script>
  </body>
</html>

